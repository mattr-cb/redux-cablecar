!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cablecar",[],e):"object"==typeof exports?exports.cablecar=e():t.cablecar=e()}(this,(function(){return(()=>{var t={392:function(t,e,n){var r,o;(function(){(function(){(function(){var t=[].slice;this.ActionCable={INTERNAL:{message_types:{welcome:"welcome",ping:"ping",confirmation:"confirm_subscription",rejection:"reject_subscription"},default_mount_path:"/cable",protocols:["actioncable-v1-json","actioncable-unsupported"]},WebSocket:window.WebSocket,logger:window.console,createConsumer:function(t){var e;return null==t&&(t=null!=(e=this.getConfig("url"))?e:this.INTERNAL.default_mount_path),new i.Consumer(this.createWebSocketURL(t))},getConfig:function(t){var e;return null!=(e=document.head.querySelector("meta[name='action-cable-"+t+"']"))?e.getAttribute("content"):void 0},createWebSocketURL:function(t){var e;return t&&!/^wss?:/i.test(t)?((e=document.createElement("a")).href=t,e.href=e.href,e.protocol=e.protocol.replace("http","ws"),e.href):t},startDebugging:function(){return this.debugging=!0},stopDebugging:function(){return this.debugging=null},log:function(){var e,n;if(e=1<=arguments.length?t.call(arguments,0):[],this.debugging)return e.push(Date.now()),(n=this.logger).log.apply(n,["[ActionCable]"].concat(t.call(e)))}}}).call(this)}).call(this);var i=this.ActionCable;(function(){(function(){i.ConnectionMonitor=function(){var t,e,n;function r(t){var e,n;this.connection=t,this.visibilityDidChange=(e=this.visibilityDidChange,n=this,function(){return e.apply(n,arguments)}),this.reconnectAttempts=0}return r.pollInterval={min:3,max:30},r.staleThreshold=6,r.prototype.start=function(){if(!this.isRunning())return this.startedAt=e(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange),i.log("ConnectionMonitor started. pollInterval = "+this.getPollInterval()+" ms")},r.prototype.stop=function(){if(this.isRunning())return this.stoppedAt=e(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange),i.log("ConnectionMonitor stopped")},r.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},r.prototype.recordPing=function(){return this.pingedAt=e()},r.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt,i.log("ConnectionMonitor recorded connect")},r.prototype.recordDisconnect=function(){return this.disconnectedAt=e(),i.log("ConnectionMonitor recorded disconnect")},r.prototype.startPolling=function(){return this.stopPolling(),this.poll()},r.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},r.prototype.poll=function(){return this.pollTimeout=setTimeout((t=this,function(){return t.reconnectIfStale(),t.poll()}),this.getPollInterval());var t},r.prototype.getPollInterval=function(){var e,n,r,o;return r=(o=this.constructor.pollInterval).min,n=o.max,e=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*t(e,r,n))},r.prototype.reconnectIfStale=function(){if(this.connectionIsStale())return i.log("ConnectionMonitor detected stale connection. reconnectAttempts = "+this.reconnectAttempts+", pollInterval = "+this.getPollInterval()+" ms, time disconnected = "+n(this.disconnectedAt)+" s, stale threshold = "+this.constructor.staleThreshold+" s"),this.reconnectAttempts++,this.disconnectedRecently()?i.log("ConnectionMonitor skipping reopening recent disconnect"):(i.log("ConnectionMonitor reopening"),this.connection.reopen())},r.prototype.connectionIsStale=function(){var t;return n(null!=(t=this.pingedAt)?t:this.startedAt)>this.constructor.staleThreshold},r.prototype.disconnectedRecently=function(){return this.disconnectedAt&&n(this.disconnectedAt)<this.constructor.staleThreshold},r.prototype.visibilityDidChange=function(){if("visible"===document.visibilityState)return setTimeout((t=this,function(){if(t.connectionIsStale()||!t.connection.isOpen())return i.log("ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = "+document.visibilityState),t.connection.reopen()}),200);var t},e=function(){return(new Date).getTime()},n=function(t){return(e()-t)/1e3},t=function(t,e,n){return Math.max(e,Math.min(n,t))},r}()}).call(this),function(){var t,e,n,r,o,c=[].slice,u=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};r=i.INTERNAL,e=r.message_types,n=r.protocols,o=2<=n.length?c.call(n,0,t=n.length-1):(t=0,[]),n[t++],i.Connection=function(){function t(t){var e,n;this.consumer=t,this.open=(e=this.open,n=this,function(){return e.apply(n,arguments)}),this.subscriptions=this.consumer.subscriptions,this.monitor=new i.ConnectionMonitor(this),this.disconnected=!0}return t.reopenDelay=500,t.prototype.send=function(t){return!!this.isOpen()&&(this.webSocket.send(JSON.stringify(t)),!0)},t.prototype.open=function(){return this.isActive()?(i.log("Attempted to open WebSocket, but existing socket is "+this.getState()),!1):(i.log("Opening WebSocket, current state is "+this.getState()+", subprotocols: "+n),null!=this.webSocket&&this.uninstallEventHandlers(),this.webSocket=new i.WebSocket(this.consumer.url,n),this.installEventHandlers(),this.monitor.start(),!0)},t.prototype.close=function(t){var e;if((null!=t?t:{allowReconnect:!0}).allowReconnect||this.monitor.stop(),this.isActive())return null!=(e=this.webSocket)?e.close():void 0},t.prototype.reopen=function(){var t;if(i.log("Reopening WebSocket, current state is "+this.getState()),!this.isActive())return this.open();try{return this.close()}catch(e){return t=e,i.log("Failed to reopen WebSocket",t)}finally{i.log("Reopening WebSocket in "+this.constructor.reopenDelay+"ms"),setTimeout(this.open,this.constructor.reopenDelay)}},t.prototype.getProtocol=function(){var t;return null!=(t=this.webSocket)?t.protocol:void 0},t.prototype.isOpen=function(){return this.isState("open")},t.prototype.isActive=function(){return this.isState("open","connecting")},t.prototype.isProtocolSupported=function(){var t;return t=this.getProtocol(),u.call(o,t)>=0},t.prototype.isState=function(){var t,e;return e=1<=arguments.length?c.call(arguments,0):[],t=this.getState(),u.call(e,t)>=0},t.prototype.getState=function(){var t,e;for(e in WebSocket)if(WebSocket[e]===(null!=(t=this.webSocket)?t.readyState:void 0))return e.toLowerCase();return null},t.prototype.installEventHandlers=function(){var t,e;for(t in this.events)e=this.events[t].bind(this),this.webSocket["on"+t]=e},t.prototype.uninstallEventHandlers=function(){var t;for(t in this.events)this.webSocket["on"+t]=function(){}},t.prototype.events={message:function(t){var n,r,o;if(this.isProtocolSupported())switch(n=(o=JSON.parse(t.data)).identifier,r=o.message,o.type){case e.welcome:return this.monitor.recordConnect(),this.subscriptions.reload();case e.ping:return this.monitor.recordPing();case e.confirmation:return this.subscriptions.notify(n,"connected");case e.rejection:return this.subscriptions.reject(n);default:return this.subscriptions.notify(n,"received",r)}},open:function(){if(i.log("WebSocket onopen event, using '"+this.getProtocol()+"' subprotocol"),this.disconnected=!1,!this.isProtocolSupported())return i.log("Protocol is unsupported. Stopping monitor and disconnecting."),this.close({allowReconnect:!1})},close:function(t){if(i.log("WebSocket onclose event"),!this.disconnected)return this.disconnected=!0,this.monitor.recordDisconnect(),this.subscriptions.notifyAll("disconnected",{willAttemptReconnect:this.monitor.isRunning()})},error:function(){return i.log("WebSocket onerror event")}},t}()}.call(this),function(){var t=[].slice;i.Subscriptions=function(){function e(t){this.consumer=t,this.subscriptions=[]}return e.prototype.create=function(t,e){var n,r,o;return r="object"==typeof(n=t)?n:{channel:n},o=new i.Subscription(this.consumer,r,e),this.add(o)},e.prototype.add=function(t){return this.subscriptions.push(t),this.consumer.ensureActiveConnection(),this.notify(t,"initialized"),this.sendCommand(t,"subscribe"),t},e.prototype.remove=function(t){return this.forget(t),this.findAll(t.identifier).length||this.sendCommand(t,"unsubscribe"),t},e.prototype.reject=function(t){var e,n,r,o,i;for(o=[],e=0,n=(r=this.findAll(t)).length;e<n;e++)i=r[e],this.forget(i),this.notify(i,"rejected"),o.push(i);return o},e.prototype.forget=function(t){var e;return this.subscriptions=function(){var n,r,o,i;for(i=[],n=0,r=(o=this.subscriptions).length;n<r;n++)(e=o[n])!==t&&i.push(e);return i}.call(this),t},e.prototype.findAll=function(t){var e,n,r,o,i;for(o=[],e=0,n=(r=this.subscriptions).length;e<n;e++)(i=r[e]).identifier===t&&o.push(i);return o},e.prototype.reload=function(){var t,e,n,r,o;for(r=[],t=0,e=(n=this.subscriptions).length;t<e;t++)o=n[t],r.push(this.sendCommand(o,"subscribe"));return r},e.prototype.notifyAll=function(){var e,n,r,o,i,c,u;for(n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],c=[],r=0,o=(i=this.subscriptions).length;r<o;r++)u=i[r],c.push(this.notify.apply(this,[u,n].concat(t.call(e))));return c},e.prototype.notify=function(){var e,n,r,o,i,c,u;for(c=arguments[0],n=arguments[1],e=3<=arguments.length?t.call(arguments,2):[],i=[],r=0,o=(u="string"==typeof c?this.findAll(c):[c]).length;r<o;r++)c=u[r],i.push("function"==typeof c[n]?c[n].apply(c,e):void 0);return i},e.prototype.sendCommand=function(t,e){var n;return n=t.identifier,this.consumer.send({command:e,identifier:n})},e}()}.call(this),function(){i.Subscription=function(){var t;function e(e,n,r){this.consumer=e,null==n&&(n={}),this.identifier=JSON.stringify(n),t(this,r)}return e.prototype.perform=function(t,e){return null==e&&(e={}),e.action=t,this.send(e)},e.prototype.send=function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})},e.prototype.unsubscribe=function(){return this.consumer.subscriptions.remove(this)},t=function(t,e){var n,r;if(null!=e)for(n in e)r=e[n],t[n]=r;return t},e}()}.call(this),function(){i.Consumer=function(){function t(t){this.url=t,this.subscriptions=new i.Subscriptions(this),this.connection=new i.Connection(this)}return t.prototype.send=function(t){return this.connection.send(t)},t.prototype.connect=function(){return this.connection.open()},t.prototype.disconnect=function(){return this.connection.close({allowReconnect:!1})},t.prototype.ensureActiveConnection=function(){if(!this.connection.isActive())return this.connection.open()},t}()}.call(this)}).call(this),t.exports?t.exports=i:void 0===(o="function"==typeof(r=i)?r.call(e,n,e,t):r)||(t.exports=o)}).call(this)}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.r(r),n.d(r,{createCableCarRoute:()=>xt});var e=function(){function e(){var t,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n={},(t="consumers")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}var n,r;return n=e,(r=[{key:"consumerFor",value:function(t){var e=t.webSocketURL||"default";if(!this.consumers[e]){var n=t.provider.createConsumer(t.webSocketURL);this.consumers[e]=n}return this.consumers[e]}},{key:"unsubscribeAll",value:function(){Object.values(this.consumers).forEach((function(t){var e,n;null==t||null===(e=t.subscriptions)||void 0===e||null===(n=e.subscriptions)||void 0===n||n.forEach((function(t){null==t||t.unsubscribe()}))}))}}])&&t(n.prototype,r),e}(),o=n(392),i=n.n(o);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,t),s(this,"cars",[]),s(this,"provider",void 0),s(this,"webSocketURL",null),this.webSocketURL=e.webSocketURL||null,this.provider=e.provider||i()}var e,n;return e=t,(n=[{key:"addCar",value:function(t){this.cars.push(t)}},{key:"removeCar",value:function(t){var e=this.cars.indexOf(t);e>-1&&this.cars.splice(e,1)}}])&&u(e.prototype,n),t}();function l(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map((function(t){return"'"+t+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function f(t){return!!t&&!!t[Q]}function p(t){return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Y}(t)||Array.isArray(t)||!!t[G]||!!t.constructor[G]||g(t)||m(t))}function h(t,e,n){void 0===n&&(n=!1),0===d(t)?(n?Object.keys:Z)(t).forEach((function(r){n&&"symbol"==typeof r||e(r,t[r],t)})):t.forEach((function(n,r){return e(r,n,t)}))}function d(t){var e=t[Q];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:g(t)?2:m(t)?3:0}function y(t,e){return 2===d(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function v(t,e,n){var r=d(t);2===r?t.set(e,n):3===r?(t.delete(e),t.add(n)):t[e]=n}function b(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}function g(t){return H&&t instanceof Map}function m(t){return $&&t instanceof Set}function O(t){return t.o||t.t}function w(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=tt(t);delete e[Q];for(var n=Z(e),r=0;r<n.length;r++){var o=n[r],i=e[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:t[o]})}return Object.create(Object.getPrototypeOf(t),e)}function S(t,e){return void 0===e&&(e=!1),A(t)||f(t)||!p(t)||(d(t)>1&&(t.set=t.add=t.clear=t.delete=P),Object.freeze(t),e&&h(t,(function(t,e){return S(e,!0)}),!0)),t}function P(){l(2)}function A(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function j(t){var e=et[t];return e||l(18,t),e}function C(){return K}function _(t,e){e&&(j("Patches"),t.u=[],t.s=[],t.v=e)}function E(t){k(t),t.p.forEach(R),t.p=null}function k(t){t===K&&(K=t.l)}function D(t){return K={p:[],l:K,h:t,m:!0,_:0}}function R(t){var e=t[Q];0===e.i||1===e.i?e.j():e.O=!0}function x(t,e){e._=e.p.length;var n=e.p[0],r=void 0!==t&&t!==n;return e.h.g||j("ES5").S(e,t,r),r?(n[Q].P&&(E(e),l(4)),p(t)&&(t=T(e,t),e.l||M(e,t)),e.u&&j("Patches").M(n[Q],t,e.u,e.s)):t=T(e,n,[]),E(e),e.u&&e.v(e.u,e.s),t!==B?t:void 0}function T(t,e,n){if(A(e))return e;var r=e[Q];if(!r)return h(e,(function(o,i){return I(t,r,e,o,i,n)}),!0),e;if(r.A!==t)return e;if(!r.P)return M(t,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var o=4===r.i||5===r.i?r.o=w(r.k):r.o;h(3===r.i?new Set(o):o,(function(e,i){return I(t,r,o,e,i,n)})),M(t,o,!1),n&&t.u&&j("Patches").R(r,n,t.u,t.s)}return r.o}function I(t,e,n,r,o,i){if(f(o)){var c=T(t,o,i&&e&&3!==e.i&&!y(e.D,r)?i.concat(r):void 0);if(v(n,r,c),!f(c))return;t.m=!1}if(p(o)&&!A(o)){if(!t.h.F&&t._<1)return;T(t,o),e&&e.A.l||M(t,o)}}function M(t,e,n){void 0===n&&(n=!1),t.h.F&&t.m&&S(e,n)}function N(t,e){var n=t[Q];return(n?O(n):t)[e]}function F(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Object.getPrototypeOf(n)}}function L(t){t.P||(t.P=!0,t.l&&L(t.l))}function W(t){t.o||(t.o=w(t.t))}function z(t,e,n){var r=g(e)?j("MapSet").N(e,n):m(e)?j("MapSet").T(e,n):t.g?function(t,e){var n=Array.isArray(t),r={i:n?1:0,A:e?e.A:C(),P:!1,I:!1,D:{},l:e,t,k:null,o:null,j:null,C:!1},o=r,i=nt;n&&(o=[r],i=rt);var c=Proxy.revocable(o,i),u=c.revoke,s=c.proxy;return r.k=s,r.j=u,s}(e,n):j("ES5").J(e,n);return(n?n.A:C()).p.push(r),r}function U(t){return f(t)||l(22,t),function t(e){if(!p(e))return e;var n,r=e[Q],o=d(e);if(r){if(!r.P&&(r.i<4||!j("ES5").K(r)))return r.t;r.I=!0,n=X(e,o),r.I=!1}else n=X(e,o);return h(n,(function(e,o){r&&function(t,e){return 2===d(t)?t.get(e):t[e]}(r.t,e)===o||v(n,e,t(o))})),3===o?new Set(n):n}(t)}function X(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return w(t)}var J,K,V="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),H="undefined"!=typeof Map,$="undefined"!=typeof Set,q="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,B=V?Symbol.for("immer-nothing"):((J={})["immer-nothing"]=!0,J),G=V?Symbol.for("immer-draftable"):"__$immer_draftable",Q=V?Symbol.for("immer-state"):"__$immer_state",Y=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),Z="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,tt=Object.getOwnPropertyDescriptors||function(t){var e={};return Z(t).forEach((function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)})),e},et={},nt={get:function(t,e){if(e===Q)return t;var n=O(t);if(!y(n,e))return function(t,e,n){var r,o=F(e,n);return o?"value"in o?o.value:null===(r=o.get)||void 0===r?void 0:r.call(t.k):void 0}(t,n,e);var r=n[e];return t.I||!p(r)?r:r===N(t.t,e)?(W(t),t.o[e]=z(t.A.h,r,t)):r},has:function(t,e){return e in O(t)},ownKeys:function(t){return Reflect.ownKeys(O(t))},set:function(t,e,n){var r=F(O(t),e);if(null==r?void 0:r.set)return r.set.call(t.k,n),!0;if(!t.P){var o=N(O(t),e),i=null==o?void 0:o[Q];if(i&&i.t===n)return t.o[e]=n,t.D[e]=!1,!0;if(b(n,o)&&(void 0!==n||y(t.t,e)))return!0;W(t),L(t)}return t.o[e]===n&&"number"!=typeof n&&(void 0!==n||e in t.o)||(t.o[e]=n,t.D[e]=!0,!0)},deleteProperty:function(t,e){return void 0!==N(t.t,e)||e in t.t?(t.D[e]=!1,W(t),L(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=O(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r?{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:r.enumerable,value:n[e]}:r},defineProperty:function(){l(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){l(12)}},rt={};h(nt,(function(t,e){rt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),rt.deleteProperty=function(t,e){return nt.deleteProperty.call(this,t[0],e)},rt.set=function(t,e,n){return nt.set.call(this,t[0],e,n,t[0])};var ot=function(){function t(t){var e=this;this.g=q,this.F=!0,this.produce=function(t,n,r){if("function"==typeof t&&"function"!=typeof n){var o=n;n=t;var i=e;return function(t){var e=this;void 0===t&&(t=o);for(var r=arguments.length,c=Array(r>1?r-1:0),u=1;u<r;u++)c[u-1]=arguments[u];return i.produce(t,(function(t){var r;return(r=n).call.apply(r,[e,t].concat(c))}))}}var c;if("function"!=typeof n&&l(6),void 0!==r&&"function"!=typeof r&&l(7),p(t)){var u=D(e),s=z(e,t,void 0),a=!0;try{c=n(s),a=!1}finally{a?E(u):k(u)}return"undefined"!=typeof Promise&&c instanceof Promise?c.then((function(t){return _(u,r),x(t,u)}),(function(t){throw E(u),t})):(_(u,r),x(c,u))}if(!t||"object"!=typeof t){if((c=n(t))===B)return;return void 0===c&&(c=t),e.F&&S(c,!0),c}l(21,t)},this.produceWithPatches=function(t,n){return"function"==typeof t?function(n){for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return e.produceWithPatches(n,(function(e){return t.apply(void 0,[e].concat(o))}))}:[e.produce(t,n,(function(t,e){r=t,o=e})),r,o];var r,o},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var e=t.prototype;return e.createDraft=function(t){p(t)||l(8),f(t)&&(t=U(t));var e=D(this),n=z(this,t,void 0);return n[Q].C=!0,k(e),n},e.finishDraft=function(t,e){var n=(t&&t[Q]).A;return _(n,e),x(void 0,n)},e.setAutoFreeze=function(t){this.F=t},e.setUseProxies=function(t){t&&!q&&l(20),this.g=t},e.applyPatches=function(t,e){var n;for(n=e.length-1;n>=0;n--){var r=e[n];if(0===r.path.length&&"replace"===r.op){t=r.value;break}}var o=j("Patches").$;return f(t)?o(t,e):this.produce(t,(function(t){return o(t,e.slice(n+1))}))},t}(),it=new ot;function ct(t,e){return t===e}function ut(t,e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var r=e.length,o=0;o<r;o++)if(!t(e[o],n[o]))return!1;return!0}it.produce,it.produceWithPatches.bind(it),it.setAutoFreeze.bind(it),it.setUseProxies.bind(it),it.applyPatches.bind(it),it.createDraft.bind(it),it.finishDraft.bind(it),function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r]}((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ct,n=null,r=null;return function(){return ut(e,n,arguments)||(r=t.apply(null,arguments)),n=arguments,r}})),"function"==typeof Symbol&&Symbol.observable;var st=function(){return Math.random().toString(36).substring(7).split("").join(".")};function at(t){return function(e){var n=e.dispatch,r=e.getState;return function(e){return function(o){return"function"==typeof o?o(n,r,t):e(o)}}}}st(),st(),at().withExtraArgument=at;var lt,ft=(lt=function(t,e){return lt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},lt(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}lt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),pt=function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t},ht=Object.defineProperty,dt=(Object.defineProperties,Object.getOwnPropertyDescriptors,Object.getOwnPropertySymbols),yt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,bt=function(t,e,n){return e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n},gt=function(t,e){for(var n in e||(e={}))yt.call(e,n)&&bt(t,n,e[n]);if(dt)for(var r=0,o=dt(e);r<o.length;r++)n=o[r],vt.call(e,n)&&bt(t,n,e[n]);return t};"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__,"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__,function(t){function e(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=t.apply(this,n)||this;return Object.setPrototypeOf(o,e.prototype),o}ft(e,t),Object.defineProperty(e,Symbol.species,{get:function(){return e},enumerable:!1,configurable:!0}),e.prototype.concat=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.prototype.concat.apply(this,e)},e.prototype.prepend=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])?new(e.bind.apply(e,pt([void 0],t[0].concat(this)))):new(e.bind.apply(e,pt([void 0],t.concat(this))))}}(Array),function(){function t(t,e){var n=o[t];return n?n.enumerable=e:o[t]=n={configurable:!0,enumerable:e,get:function(){var e=this[Q];return nt.get(e,t)},set:function(e){var n=this[Q];nt.set(n,t,e)}},n}function e(t){for(var e=t.length-1;e>=0;e--){var o=t[e][Q];if(!o.P)switch(o.i){case 5:r(o)&&L(o);break;case 4:n(o)&&L(o)}}}function n(t){for(var e=t.t,n=t.k,r=Z(n),o=r.length-1;o>=0;o--){var i=r[o];if(i!==Q){var c=e[i];if(void 0===c&&!y(e,i))return!0;var u=n[i],s=u&&u[Q];if(s?s.t!==c:!b(u,c))return!0}}var a=!!e[Q];return r.length!==Z(e).length+(a?0:1)}function r(t){var e=t.k;if(e.length!==t.t.length)return!0;var n=Object.getOwnPropertyDescriptor(e,e.length-1);return!(!n||n.get)}var o={};!function(t,e){et[t]||(et[t]=e)}("ES5",{J:function(e,n){var r=Array.isArray(e),o=function(e,n){if(e){for(var r=Array(n.length),o=0;o<n.length;o++)Object.defineProperty(r,""+o,t(o,!0));return r}var i=tt(n);delete i[Q];for(var c=Z(i),u=0;u<c.length;u++){var s=c[u];i[s]=t(s,e||!!i[s].enumerable)}return Object.create(Object.getPrototypeOf(n),i)}(r,e),i={i:r?5:4,A:n?n.A:C(),P:!1,I:!1,D:{},l:n,t:e,k:o,o:null,O:!1,C:!1};return Object.defineProperty(o,Q,{value:i,writable:!0}),o},S:function(t,n,o){o?f(n)&&n[Q].A===t&&e(t.p):(t.u&&function t(e){if(e&&"object"==typeof e){var n=e[Q];if(n){var o=n.t,i=n.k,c=n.D,u=n.i;if(4===u)h(i,(function(e){e!==Q&&(void 0!==o[e]||y(o,e)?c[e]||t(i[e]):(c[e]=!0,L(n)))})),h(o,(function(t){void 0!==i[t]||y(i,t)||(c[t]=!1,L(n))}));else if(5===u){if(r(n)&&(L(n),c.length=!0),i.length<o.length)for(var s=i.length;s<o.length;s++)c[s]=!1;else for(var a=o.length;a<i.length;a++)c[a]=!0;for(var l=Math.min(i.length,o.length),f=0;f<l;f++)void 0===c[f]&&t(i[f])}}}}(t.p[0]),e(t.p))},K:function(t){return 4===t.i?n(t):r(t)}})}();var mt=function(t,e){return String(t).slice(0,e.length)===e},Ot=function(t){if("string"==typeof t)return function(e){return mt(String(e.type),t)};if(Array.isArray(t))return function(e){return t.some((function(t){return"string"==typeof t?mt(String(e.type),t):t instanceof RegExp?null!=String(e.type).match(t):void 0}))};if(t instanceof RegExp)return function(e){return null!=String(e.type).match(t)};if("function"==typeof t)return function(e){return t(e)};throw new TypeError("CableCar: 'permittedActions' option is not formatted correctly (string|string[]|RegExp|function)")},wt=["type","meta","payload"];function St(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Pt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?St(Object(n),!0).forEach((function(e){jt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function At(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ct="__cablecar__",_t="channel",Et="redux-cablecar",kt=function(){function t(e,n,r,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),jt(this,"consumer",void 0),jt(this,"store",void 0),jt(this,"channel",void 0),jt(this,"active",!1),jt(this,"connected",!1),jt(this,"subscription",void 0),jt(this,"_options",{}),jt(this,"_permittedActionFn",(function(){return!0})),jt(this,"_destroyCallback",void 0),this.consumer=e,this.store=n,this.channel=String(r),this.options=o||{},this.subscription=this.init(),this._destroyCallback=i}var e,n;return e=t,(n=[{key:"options",get:function(){return this._options},set:function(t){void 0!==t.permittedActions?this._permittedActionFn=Ot(t.permittedActions):this._permittedActionFn=Ot("RAILS");var e={params:t.params||{},silent:!!t.silent,matchChannel:!!t.matchChannel};t.initialized&&(e.initialized=t.initialized),t.connected&&(e.connected=t.connected),t.disconnected&&(e.disconnected=t.disconnected),t.received&&(e.received=t.received),t.rejected&&(e.rejected=t.rejected),this._options=Object.freeze(e)}},{key:"destroy",value:function(){var t;this.active=!1,this.connected=!1,null===(t=this.subscription)||void 0===t||t.unsubscribe(),this.subscription=null,this._destroyCallback&&(this._destroyCallback(),this._destroyCallback=void 0)}},{key:"perform",value:function(t,e){this.isReady(),this.subscription.perform(t,e)}},{key:"send",value:function(t){this.isReady(),this.subscription.send(t)}},{key:"pause",value:function(){this.active=!1}},{key:"resume",value:function(){this.active=!0}},{key:"permitsAction",value:function(t){var e=!(t.meta&&t.meta.__cablecar__);return!(this.options.matchChannel&&e&&t.meta&&t.meta.channel&&t.meta.channel!=this.channel)&&(e&&(e=this._permittedActionFn(t)),e)}},{key:"init",value:function(){var t=this,e=function(e){t.store&&!t.options.silent&&t.store.dispatch(e)},n=function(e){return function(t,e){function n(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(e){var o=e.apply(void 0,n);if(!o)throw new Error("prepareAction did not return an object");return gt(gt({type:t,payload:o.payload},"meta"in o&&{meta:o.meta}),"error"in o&&{error:o.error})}return{type:t,payload:n[0]}}return n.toString=function(){return""+t},n.type=t,n.match=function(e){return e.type===t},n}(e,(function(){var e;return{payload:{},meta:(e={},jt(e,Ct,!0),jt(e,_t,t.channel),e)}}))()};return this.consumer.subscriptions.create(Pt({channel:this.channel},this.options.params),{initialized:function(){t.active=!0,e(n("".concat(Et,"/INIT"))),t.options.initialized&&t.options.initialized()},connected:function(){t.connected=!0,e(n("".concat(Et,"/CONNECTED"))),t.options.connected&&t.options.connected()},disconnected:function(){t.connected=!1,e(n("".concat(Et,"/DISCONNECTED"))),t.options.disconnected&&t.options.disconnected()},received:function(n){var r,o=n.type,i=n.meta,c=n.payload,u=function(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(n,wt),s={payload:Pt(Pt({},c),u),meta:Pt(Pt({},i),{},(r={},jt(r,Ct,!0),jt(r,_t,t.channel),r)),type:o||"".concat(Et,"/RECEIVED")};e(s)},rejected:function(r){t.active=!1,t.connected=!1,e(n("".concat(Et,"/REJECTED"))),t.options.rejected?t.options.rejected():console.error("CableCar: connection rejected. (Channel: ".concat(t.channel,") ").concat(r))}})}},{key:"isReady",value:function(){if(!this.connected)throw new TypeError("CableCar channel: ".concat(this.channel," is disconnected."));if(!this.active)throw new TypeError("CableCar channel: ".concat(this.channel," is paused."))}}])&&At(e.prototype,n),t}();function Dt(t){return function(e){return function(n){return function(r){var o=t.cars.filter((function(t){return t.active&&t.permitsAction(r)})),i=!1;return o.length&&(i=o.reduce((function(t,e){var n=r.meta;return e.connected?(e.send(r),t&&null!=n&&n.isOptimistic&&(t=!1)):((null!=n&&n.isOptimistic||null!=n&&n.isOptimisticOnFail)&&(t=!1),console.error("CableCar channel: ".concat(e.channel," Dropped action.")+(t?"":" Action passed thru middleware to Redux (optimistic)."),r)),t}),!0)),i?e.getState():n(r)}}}}var Rt=new e;function xt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new a(t),n=Rt.consumerFor(e);return{createMiddleware:function(){return Dt(e)},connect:function(t,r,o){var i=new kt(n,t,r,o||{},(function(){e.removeCar(i)}));return e.addCar(i),Tt(i)},allCars:function(){return e.cars.map(Tt)},reset:function(){e.cars=[]}}}function Tt(t){return{destroy:function(){return t.destroy()},pause:function(){return t.pause()},resume:function(){return t.resume()},perform:function(e,n){return t.perform(e,n)},send:function(e){return t.send(e)}}}"undefined"!=typeof window&&window.addEventListener("beforeunload",(function(){Rt.unsubscribeAll()}))})(),r})()}));
//# sourceMappingURL=redux-cablecar.js.map